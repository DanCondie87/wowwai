# Progress Log

## US-001: Project Scaffolding [DONE]
- Next.js 16 + TypeScript + Tailwind CSS v4 + shadcn/ui already set up
- Created missing directories: convex/, scripts/, docs/, src/hooks/
- Created app route directories: board/, workflows/, analytics/, my-work/, settings/
- 14 shadcn/ui components pre-installed
- .gitignore updated with .convex/ exclusion
- Note: Convex not yet initialized (no npx convex dev) ‚Äî will deploy later
- CLAUDE.md already in place with full project conventions

## US-002: Tokenized Theme System [DONE]
- CSS variables already configured in globals.css (OKLch color model, light + dark)
- Created ThemeProvider component wrapping next-themes
- Created ThemeToggle component (sun/moon icon, shadcn Button)
- Updated layout.tsx: ThemeProvider with attribute="class", defaultTheme="system", enableSystem
- Added suppressHydrationWarning to <html> for next-themes compatibility
- Replaced boilerplate page.tsx with WOWWAI landing + theme toggle
- Typecheck passes

## US-004: Convex Schema ‚Äî Projects & Ideas [DONE]
- Created convex/schema.ts with projects and ideas tables
- Projects: name, slug, description, status (active/archived), color, createdAt
- Ideas: projectId (optional), title, description, tags, status, source, createdAt
- Indexes: projects by_status, ideas by_projectId and by_status
- Created _generated stubs (dataModel, server, api) for typecheck without Convex init
- Typecheck passes

## US-005: Convex Schema ‚Äî Tasks & Audit Logs [DONE]
- Tasks table: full spec with projectId, parentTaskId, cardId, status union, assignee, priority, tags, blockedBy array, position, timestamps
- AuditLogs table: taskId, actor union, action, before/after, comment, modelUsed, timestamp
- Indexes: tasks by_projectId, by_status, by_assignee, by_parentTaskId; auditLogs by_taskId
- Typecheck passes

## US-006: Convex Schema ‚Äî Workflows, File Sync, Agent Activity [DONE]
- workflowTemplates: name, description, sourceFile, createdAt
- workflowSteps: templateId, name, description, order, loop fields, references array, model/agent info
- fileVersions: filePath, content, editedBy, editedVia, snapshotName, timestamp (indexed by_filePath)
- fileSyncQueue: filePath, content, direction, status, timestamp (indexed by_status, by_filePath)
- agentActivity: taskId, sessionKey, model, status, currentAction, timestamps (indexed by_taskId, by_sessionKey, by_status)
- Typecheck passes

## US-007: Project CRUD Mutations & Queries [DONE]
- create: takes name, color, description; auto-generates slug via slugify()
- update: takes id + optional name/slug/color/description; auto-regenerates slug when name changes
- archive: sets status to "archived"
- getAll: returns active projects using by_status index
- getById: returns single project by id
- Typecheck passes

## US-008: Task CRUD Mutations & Queries [DONE]
- create: auto-generates cardId as {SLUG}-{N}, sets position to max+1 in column
- update: diffs fields, creates audit log entry per changed field
- moveToColumn: updates status + position, sets completedAt when moving to "done"
- reorder: updates position within same column
- getByProject: sorted by status then position
- getByStatus: returns all tasks across projects for a given status
- getById: returns task + subtasks (child tasks via parentTaskId)
- All mutations create audit log entries inline (same transaction)
- Typecheck passes

## US-009: Audit Log Mutations & Queries [DONE]
- create mutation: public-facing, takes taskId, actor, action, before/after, comment, modelUsed
- createInternal: internal mutation for use by other Convex functions
- getByTask query: returns logs for a task, sorted by timestamp descending
- Task mutations (US-008) inline audit log creation for status changes, field updates, moves
- Typecheck passes

## US-003: Clerk Authentication [DONE]
- ConvexProvider wraps the app in layout.tsx (dev mode without Clerk keys)
- TODO comments mark where ConvexProviderWithClerk + ClerkProvider go
- middleware.ts stub created (no-op, passes all requests through)
- Sign-in page at /sign-in with placeholder (ready for Clerk <SignIn />)
- Sign-up page at /sign-up with placeholder (ready for Clerk <SignUp />)
- Auth routes under (auth) route group
- Typecheck passes

## US-010: App Layout Shell [DONE]
- AppLayout component: header + collapsible sidebar + main content
- AppHeader: WOWWAI logo, theme toggle, user button placeholder, hamburger on mobile
- AppSidebar: Board, Workflows, My Work nav links with active state
- Mobile: sidebar hidden by default, opens with overlay on hamburger click
- Desktop: sidebar always visible, static positioning
- (app) route group wraps board/workflows/my-work/settings/analytics
- Root page redirects to /board
- Placeholder pages for workflows, my-work, settings, analytics
- Typecheck passes

## US-011: Kanban Board ‚Äî Column Layout [DONE]
- Board page at /board with 5 task status columns: Backlog, To Do, In Progress, Review, Done
- KanbanBoard component: project filter dropdown, mobile column tabs, desktop horizontal scroll
- KanbanColumn component: header with name + count, scrollable card list, "+" add button
- Mobile: tab navigation to switch between columns (one at a time)
- Desktop: all columns visible side-by-side with horizontal scroll
- Empty state: "No tasks yet" message per column
- Added tasks.getAll query to convex/tasks.ts
- Column definitions in lib/columns.ts
- Typecheck passes

## US-012: Task Card Component [DONE]
- Project color strip (3px left border)
- Card ID in muted text, title bold
- Assignee avatar: shark emoji for dali, person for dan
- Priority dot: green/blue/orange/red for low/medium/high/urgent
- Tags as pills (max 3 visible, +N overflow)
- Subtask progress bar with fraction text
- BLOCKED badge (destructive variant) when blockedBy is non-empty
- Staleness indicator: green <24h, yellow 1-3d, orange 3-7d, red >7d
- Hover elevation, focus-visible ring
- Columns only show top-level tasks (filter out subtasks)
- Typecheck passes

## US-013: Drag and Drop Between Columns [DONE]
- DndContext wraps the board with PointerSensor + TouchSensor
- SortableContext + useSortable for card dragging within/between columns
- useDroppable on columns for cross-column drop targets
- DragOverlay shows ghost card during drag
- Touch-friendly: 200ms delay activation for mobile long-press
- Column highlights with ring-2 when hovered during drag
- handleDragEnd calls moveToColumn for cross-column moves, reorder for same-column
- Board page wired up with onAddTask and onCardClick callbacks
- Stub components created for CreateTaskDialog and CardDetailSheet
- Typecheck passes

## US-014: Create Task Modal [DONE]
- Dialog with form: title (required), description, project select, assignee select, priority select, tags (comma-separated)
- Uses shadcn Dialog, Input, Textarea, Select components
- Task created in the column where "+" was clicked (defaultStatus prop)
- Calls tasks.create mutation with all fields
- Form resets on close, submit disabled while creating
- Typecheck passes

## US-015: Card Detail View [DONE]
- shadcn Sheet as side drawer (right, w-full sm:max-w-lg)
- Editable inline title (click to edit, Enter/Escape/blur to save)
- Editable description, tags, definitionOfDone, testingCriteria, figmaLink
- Select dropdowns for assignee and priority
- Status shown as badge (read-only ‚Äî changed via drag)
- Auto-save on blur with "Saved" flash confirmation
- BLOCKED badge when blockedBy is non-empty
- Embeds SubtaskList (stub) and AuditTrail (stub)
- Typecheck passes

## US-016: Subtask Display in Card Detail [DONE]
- SubtaskList component: shows child tasks with title, status badge, assignee avatar
- Progress bar showing done/total count
- Inline "Add subtask" form: title + assignee select, creates task with parentTaskId
- Clicking subtask navigates to its detail view via onOpenSubtask callback
- BackToParent component: "‚Üê Back to parent" link in subtask detail view
- CardDetailSheet updated: onNavigate prop, BackToParent shown for subtasks
- Board page wired up: onNavigate sets detailTaskId to navigate between parent/child
- Typecheck passes

## US-017: Audit Trail in Card Detail [DONE]
- AuditTrail component loads audit logs via auditLogs.getByTask reactive query
- Each entry: actor avatar (ü¶à/üë§/‚öôÔ∏è), human-readable action, relative timestamp
- Status changes shown with old ‚Üí new colored badges
- Comments displayed in muted italic block
- Model used shown as small text badge
- Typecheck passes

## US-018: Blocker/Dependency Indicators [DONE]
- BlockerList component: shows blockers with card ID, title, status badge, navigate link
- Add blocker: Select picker with tasks from same project (excludes self and existing blockers)
- Remove blocker: X button removes from blockedBy array via update mutation
- BLOCKED badge on task card auto-updates reactively (blockedBy array empty = no badge)
- Replaces simple BLOCKED badge in card detail with full blocker management
- Typecheck passes

## US-019: Session Summary Field [DONE]
- SessionSummary component: click-to-edit markdown field with rehype-sanitize
- Read-only view: rendered markdown via react-markdown, prominent border when done
- Edit mode: textarea with markdown support, save on blur, Escape to cancel
- Empty state: dashed border placeholder "Click to add session summary..."
- Displayed prominently (primary border + bg tint) when task status is "done"
- Uses rehype-sanitize for all markdown rendering per security conventions
- Typecheck passes

## US-020: Global Search [DONE]
- convex/search.ts: searchTasks query with full-text search across title and cardId
- Search indexes added to schema: search_title (filterFields: projectId, status), search_cardId (filterFields: projectId)
- Results enriched with project name and color
- Deduplication when same task matches both title and cardId
- Returns up to 20 results
- Typecheck passes

## US-021: Command Palette [DONE]
- CommandPalette component using shadcn CommandDialog (cmdk)
- Cmd+K / Ctrl+K keyboard shortcut to open/close
- Search input searches tasks via searchTasks query (US-020)
- Results grouped: Tasks (with project dot, cardId, title, status, assignee), Actions (Create task), Navigation (Board, My Work, Workflows, Analytics, Settings)
- Search icon added to header for mobile access
- External open/close control via externalOpen/onExternalOpenChange props
- AppLayout wires header search button to command palette open state
- Typecheck passes

## US-022: Cross-Project My Work View [DONE]
- getByAssignee query: returns non-done, non-subtask tasks for given assignee (or all)
- getAllTags query: returns distinct tags across all tasks (for US-023)
- My Work page: tasks grouped by project with project color dot and name header
- Assignee toggle: All / Dan / Dali button group
- Sort by: priority, staleness, project (Select dropdown)
- Compact task rows: priority dot, cardId, title, status badge, blocked badge, assignee
- Click task opens CardDetailSheet with full navigation support
- Typecheck passes

## US-023: Tag System [DONE]
- Tags displayed as colored pills on cards using getTagColor hash-based palette (already existed from US-012)
- Upgraded EditableTags in card-detail-sheet: type tag name, Enter to add, X to remove
- Autocomplete dropdown: queries getAllTags (already existed from US-022), shows matching suggestions as colored pills
- Colored pill display in both card-detail and task-card views
- Typecheck passes

## US-024: Board Filter Bar [DONE]
- BoardFilterBar component: project dropdown, assignee toggle (All/Dan/Dali), priority multi-select, tag multi-select, "Blocked only" toggle
- Filters apply to all columns simultaneously via pre-filtering in board page
- Active filter count shown as badge
- "Clear" button resets all filters
- Filter state persisted in URL query params (?project=X&assignee=dan&priority=high,urgent&tags=ui,api&blocked=true)
- Mobile: "Filters" button opens bottom Sheet with same controls
- Removed old project-only filter from KanbanBoard; board now receives pre-filtered tasks
- Typecheck passes

## US-025: Agent API with Shared Secret Auth [DONE]
- convex/http.ts: HTTP router with 3 endpoints + CORS preflight handlers
- POST /agent/updateTask: cardId lookup, updates status/modelUsed/sessionSummary, optional comment as audit log
- POST /agent/createAuditLog: creates audit log entry for a task by cardId
- GET /agent/getTask: returns task data by cardId query param
- All endpoints verify x-agent-secret header against AGENT_SECRET env var, return 401 if invalid
- CORS headers: allow Vercel origin + localhost:3000 + localhost:3001
- Added internal query getByCardId and internal mutation agentUpdate to tasks.ts
- Typecheck passes

## US-026: Rate Limiting on Agent API [DONE]
- Installed convex-helpers package
- Added rateLimitTables to schema.ts (required for convex-helpers rate limiting)
- Created convex/rateLimiter.ts with token bucket config: 10/min, burst to 20
- All 3 HTTP agent endpoints (updateTask, createAuditLog, getTask) check rate limit before processing
- Returns 429 Too Many Requests with Retry-After header when limit exceeded
- Typecheck passes

## US-027: Content Security Headers [DONE]
- next.config.ts: security headers on all routes ‚Äî X-Content-Type-Options, X-Frame-Options, X-XSS-Protection, Content-Security-Policy
- CSP: default-src 'self', connect-src to Convex cloud/site/wss, script-src/style-src 'self' 'unsafe-inline', img-src 'self' data: https:
- Created shared Markdown component (src/components/ui/markdown.tsx) with rehype-sanitize always applied
- Updated card-detail-sheet to use shared Markdown component
- Verified: no dangerouslySetInnerHTML anywhere in codebase
- Typecheck passes

## US-028: Data Export [DONE]
- convex/export.ts: getFullExport query returns projects, tasks, ideas, auditLogs
- Settings page at /settings with Export Data section
- Export as JSON: full dump file (wowwai-export-YYYY-MM-DD.json)
- Export as CSV: tasks table as CSV with headers (cardId, title, project, status, assignee, priority, tags, createdAt, completedAt)
- Added Settings to sidebar navigation
- Typecheck passes

## US-029: Workflow Template Queries [DONE]
- convex/workflows.ts: getAllTemplates (returns templates with stepCount), getTemplateWithSteps (template + sorted steps)
- createTemplate mutation: name, description, sourceFile
- createStep mutation: full step definition with loop fields, references, modelRecommendation, agentType
- Typecheck passes

## US-030: Workflow Seed Data [DONE]
- Seed script convex/seed.ts already exists with 3 templates: Code Project, Research, Self-Improving Skills
- Created workflow markdown files: workflows/code-project.md, workflows/research.md, workflows/self-improving-skills.md
- Each template has full step definitions with references, loop groups, model recommendations, agent types
- Code Project: 7 steps with build-test loop (Implementation + Testing, max 5 iterations)
- Research: 5 steps with analyze-refine loop (Analysis + Gap Identification, max 3 iterations)
- Self-Improving Skills: 5 steps with practice-feedback loop (Practice + Self-Evaluation, max 5 iterations)
- Seed is idempotent (checks existing template names before inserting)
- Typecheck passes

## US-031: Workflows List Page [DONE]
- Workflows page at /workflows showing all templates as cards
- Each card: workflow icon, name, description, step count badge, source file badge
- Cards link to /workflows/[id] for detail view
- Loading state and empty state handled
- Uses getAllTemplates query (enriched with stepCount)
- Typecheck passes

## US-032: Vertical Pipeline Renderer [DONE]
- Workflow detail page at /workflows/[id] with template name, description, back button
- WorkflowPipeline component: vertical pipeline with connector line and dots
- Each step: collapsible accordion card with step number, agent type icon, name
- Expanded view shows: description, model recommendation badge, references list
- Agent-type icons: planner, architect, coder, tester, reviewer, deployer, researcher, analyst, writer, assessor, practitioner, evaluator
- Vertical line connects all steps, dot markers at each step
- Typecheck passes

## US-033: Loop Group Containers [DONE]
- LoopGroupContainer component: tinted bg-primary/5 container with dashed border
- Header: repeat icon, loop name (human-readable), step count badge, max iterations badge
- Exit criteria shown below header
- Collapsible: click header to expand/collapse (starts expanded)
- Steps inside loop indented with pl-2 and dashed borders
- groupSteps() function groups steps by loopGroupId into LoopGroup objects
- isLoopGroup() type guard distinguishes groups from individual steps
- Typecheck passes

## US-034: Document Reference Display [DONE]
- DocumentReference component: shows type icon, label, file path, View/Edit buttons
- View button opens Sheet panel showing file content from fileVersions table
- Content rendered as markdown using rehype-sanitize Markdown component
- "Not synced" indicator when no content in fileVersions
- convex/fileVersions.ts: getByFilePath, getLatestByFilePath, createVersion, getVersionCount queries/mutations
- convex/fileSyncQueue.ts: enqueue, getPending, updateStatus queries/mutations
- Typecheck passes

## Learnings
- Convex 1.31 uses *Generic pattern (mutationGeneric, queryGeneric) not *Builder
- _generated stubs must use typeof import("convex/server").mutationGeneric for type compat
- Audit logs created inline via ctx.db.insert in same transaction as task mutations

---
