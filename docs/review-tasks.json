{
  "_comment": "WOWWAI Review Tasks — import into WOWWAI Convex schema. Create 'REVIEW' project first, then import tasks.",
  "_schema_version": "convex/schema.ts v1",
  "_instructions": "1. Create a project with name='WOWWAI Security & Quality Review', slug='review', color='#e11d48'. 2. Import tasks below, setting projectId to the created project's _id.",

  "project": {
    "name": "WOWWAI Security & Quality Review",
    "slug": "review",
    "description": "Systematic multi-dimensional review of WOWWAI covering security, testing, code quality, architecture, frontend, dependencies, and performance.",
    "status": "active",
    "color": "#e11d48"
  },

  "tasks": [
    {
      "_importId": "SEC-001",
      "cardId": "REVIEW-1",
      "title": "Auth Implementation Audit — timing attacks & password hashing",
      "description": "Audit src/lib/auth.ts for timing attack vulnerabilities (non-constant-time comparisons), SHA-256 password hashing weaknesses, and cookie hardening. Implement timing-safe comparisons using crypto.subtle. Document AUTH_SECRET entropy requirements.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "urgent",
      "tags": ["security", "auth", "critical"],
      "definitionOfDone": "All string comparisons in auth.ts use timing-safe equivalents. SHA-256 risk is acknowledged or replaced. Cookie flags are documented and justified.",
      "testingCriteria": "Unit tests pass for all auth functions including tampered token edge cases. No === comparison between secrets in auth code."
    },
    {
      "_importId": "SEC-002",
      "cardId": "REVIEW-2",
      "title": "Middleware Auth Bypass Analysis — CVE-2025-29927 & path bypass vectors",
      "description": "Verify Next.js 16.1.6 is not vulnerable to CVE-2025-29927 (x-middleware-subrequest bypass). Audit PUBLIC_ROUTES list. Assess pathname.includes('.') bypass potential. Verify middleware matcher regex coverage.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "urgent",
      "tags": ["security", "middleware", "critical"],
      "definitionOfDone": "CVE-2025-29927 patch status confirmed. All potential bypass vectors documented. Middleware matcher reviewed and hardened if needed.",
      "testingCriteria": "Middleware tests cover bypass attempt paths. CVE status is documented with version evidence."
    },
    {
      "_importId": "SEC-003",
      "cardId": "REVIEW-3",
      "title": "Convex Unauthenticated Access — design & implement auth for all public queries/mutations",
      "description": "CRITICAL: All Convex public queries and mutations are unauthenticated. getFullExport and fileSyncQueue.enqueue are particularly dangerous. Design and implement auth propagation from Next.js session to Convex server-side validation.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "urgent",
      "tags": ["security", "convex", "critical"],
      "definitionOfDone": "All sensitive queries/mutations have auth checks. getFullExport and enqueue are protected. Architecture decision recorded.",
      "testingCriteria": "Unauthenticated calls to protected functions return 401. Integration tests verify auth flow end-to-end."
    },
    {
      "_importId": "SEC-004",
      "cardId": "REVIEW-4",
      "title": "File System Write Security Audit — sync-agent path traversal & content injection",
      "description": "Audit sync-agent resolveSafePath() for Windows case-sensitivity issues and symlink attacks. Assess the attack chain: unauthenticated enqueue mutation → Convex queue → sync-agent writes to disk. Review content sanitization.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "urgent",
      "tags": ["security", "filesystem", "critical"],
      "definitionOfDone": "All file write attack vectors assessed with mitigations documented. resolveSafePath hardened for Windows edge cases. Content validation added or risk accepted.",
      "testingCriteria": "Path traversal attempts are blocked by resolveSafePath. Symlink attack scenario documented."
    },
    {
      "_importId": "SEC-005",
      "cardId": "REVIEW-5",
      "title": "HTTP API Security — timing attacks on AGENT_SECRET & CORS policy",
      "description": "Fix verifySecret() timing attack in convex/http.ts (secret === expected). Review CORS allowed origin construction. Assess per-IP rate limiting adequacy. Validate all body inputs for injection risks.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["security", "api", "convex"],
      "definitionOfDone": "verifySecret uses timing-safe comparison. CORS logic is documented and correct. Rate limiting strategy is adequate.",
      "testingCriteria": "Timing-safe comparison in place. CORS tested with allowed and disallowed origins."
    },
    {
      "_importId": "SEC-006",
      "cardId": "REVIEW-6",
      "title": "CSP & Security Header Hardening — remove unsafe-inline, add missing headers",
      "description": "Remove script-src 'unsafe-inline' from next.config.ts CSP. Add HSTS, Referrer-Policy, Permissions-Policy, COOP, COEP headers. Review rehype-sanitize configuration in markdown.tsx.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["security", "headers", "xss"],
      "definitionOfDone": "CSP does not contain unsafe-inline for scripts. All recommended security headers present. Markdown sanitization verified.",
      "testingCriteria": "securityheaders.com scan passes with A rating. CSP validated against Next.js requirements."
    },
    {
      "_importId": "TEST-001",
      "cardId": "REVIEW-7",
      "title": "Test Infrastructure Setup — Vitest + Playwright + Convex testing",
      "description": "Install and configure Vitest for unit/integration tests, Playwright for E2E tests, and @convex-dev/testing for Convex function tests. Add test scripts to package.json. Set up folder structure.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["testing", "infrastructure"],
      "definitionOfDone": "npm test runs successfully. npm run test:e2e starts and runs a basic navigation test. Test folder structure created.",
      "testingCriteria": "At least one passing smoke test in each test category."
    },
    {
      "_importId": "TEST-002",
      "cardId": "REVIEW-8",
      "title": "Auth Unit Tests — full branch coverage of src/lib/auth.ts",
      "description": "Write unit tests for all functions in auth.ts: sha256, sign, createSessionToken, verifySessionToken (valid/expired/tampered), verifyPassword (correct/wrong/edge cases). Target full branch coverage.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "urgent",
      "tags": ["testing", "auth", "unit-tests"],
      "definitionOfDone": "≥15 passing tests covering all branches. Expired token, tampered payload, tampered signature all tested.",
      "testingCriteria": "Full branch coverage of auth.ts shown in coverage report."
    },
    {
      "_importId": "TEST-003",
      "cardId": "REVIEW-9",
      "title": "API Route Integration Tests — login, logout, rate limiting",
      "description": "Write integration tests for /api/auth/login and /api/auth/logout routes. Cover: correct password, wrong password, missing password, rate limiting (5 attempts then 429), cookie flags.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["testing", "api", "integration-tests"],
      "definitionOfDone": "All API route behaviors tested including rate limiting. Cookie flags verified in test assertions.",
      "testingCriteria": "Tests pass and cover all documented API behaviors."
    },
    {
      "_importId": "TEST-004",
      "cardId": "REVIEW-10",
      "title": "Middleware Tests — auth enforcement & bypass prevention",
      "description": "Write tests for middleware.ts covering: unauthenticated access to protected routes (redirect), public routes (pass through), valid cookie (pass through), expired cookie (redirect + clear), tampered cookie (redirect).",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["testing", "middleware", "security"],
      "definitionOfDone": "All middleware auth scenarios have tests. Bypass attempt paths are tested and confirmed blocked.",
      "testingCriteria": "Tests cover all PUBLIC_ROUTES and protected route behaviors."
    },
    {
      "_importId": "TEST-005",
      "cardId": "REVIEW-11",
      "title": "E2E Test Suite — Playwright auth & task management flows",
      "description": "Write Playwright E2E tests for: login flow (success/failure), protected route redirect, create task, drag task between columns, logout. Tests should run headless in CI.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["testing", "e2e", "playwright"],
      "definitionOfDone": "E2E suite passes against dev server. Tests run headless. Login, task creation, and drag-drop covered.",
      "testingCriteria": "All E2E tests pass on clean checkout with dev server running."
    },
    {
      "_importId": "TEST-006",
      "cardId": "REVIEW-12",
      "title": "Convex Function Tests — task lifecycle & project operations",
      "description": "Write tests for Convex functions using @convex-dev/testing: tasks.create (cardId generation, defaults), tasks.moveToColumn (completedAt on done), tasks.getById (includes subtasks), projects.create.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "medium",
      "tags": ["testing", "convex", "unit-tests"],
      "definitionOfDone": "Core task lifecycle operations have test coverage. cardId generation logic tested.",
      "testingCriteria": "Convex function tests pass with in-memory Convex backend."
    },
    {
      "_importId": "QUAL-001",
      "cardId": "REVIEW-13",
      "title": "TypeScript Strictness Audit — strict mode, any types, unsafe assertions",
      "description": "Review tsconfig.json for strict mode status. Audit for any types, non-null assertions, unsafe as casts. Verify Convex validator types match handler usage. Enable strict mode if not already on.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["code-quality", "typescript"],
      "definitionOfDone": "strict mode enabled in tsconfig. No any types in security-relevant code. Findings documented in QUAL-TYPESCRIPT.md.",
      "testingCriteria": "tsc --strict compiles without errors."
    },
    {
      "_importId": "QUAL-002",
      "cardId": "REVIEW-14",
      "title": "Error Handling Review — unhandled async errors & info leakage",
      "description": "Audit all async operations for missing try/catch. Check API routes for error info leakage. Review Convex mutation error propagation to UI. Assess catch {} in login route. Check all JSON.parse and atob calls.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["code-quality", "error-handling"],
      "definitionOfDone": "All security-relevant code has proper error handling. No error messages leak sensitive info to users.",
      "testingCriteria": "Error scenarios handled gracefully in both API routes and UI components."
    },
    {
      "_importId": "QUAL-003",
      "cardId": "REVIEW-15",
      "title": "Dead Code & Unused Dependencies Audit",
      "description": "Run ts-unused-exports to find unused exports. Audit package.json dependencies for unused packages. Check scripts/ folder, convex/seed.ts, convex/recommend.ts, convex/analytics.ts for whether they're wired up.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "medium",
      "tags": ["code-quality", "cleanup"],
      "definitionOfDone": "Unused code removed or documented as intentional. package.json cleaned up.",
      "testingCriteria": "npm build succeeds after cleanup. No import errors."
    },
    {
      "_importId": "ARCH-001",
      "cardId": "REVIEW-16",
      "title": "Convex Schema Hardening — replace v.string() with typed literal unions",
      "description": "fileSyncQueue.direction and .status use v.string() — replace with typed unions. agentActivity.status same issue. Review all schema fields that should be enums. Verify indexes cover all query patterns.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["architecture", "convex", "schema"],
      "definitionOfDone": "All status/direction/enum fields use v.union(v.literal()) instead of v.string(). Migration written if needed.",
      "testingCriteria": "Convex deployment succeeds. All existing queries still work with new schema."
    },
    {
      "_importId": "ARCH-002",
      "cardId": "REVIEW-17",
      "title": "API Architecture Review — document data flow & agent routing decisions",
      "description": "Document why agent operations go through Convex HTTP routes vs Next.js API routes. Document /api/agent middleware bypass intent. Create architecture diagram for data flows. Update DECISIONS.md.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "medium",
      "tags": ["architecture", "documentation"],
      "definitionOfDone": "Architecture diagram created. Data flow documented. DECISIONS.md updated with routing rationale.",
      "testingCriteria": "Documentation reviewed and approved by Dan."
    },
    {
      "_importId": "FRONT-001",
      "cardId": "REVIEW-18",
      "title": "XSS & Injection Review — markdown rendering, dangerouslySetInnerHTML, audit logs",
      "description": "Audit rehype-sanitize configuration in markdown.tsx for completeness (blocks script, javascript: href, event handlers). Find all dangerouslySetInnerHTML usages. Audit audit-trail.tsx for XSS via before/after content.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["security", "frontend", "xss"],
      "definitionOfDone": "rehype-sanitize blocks all known XSS vectors. All dangerouslySetInnerHTML instances audited. Audit log content is safely rendered.",
      "testingCriteria": "XSS test payloads (script injection, img onerror, javascript: href) are blocked in markdown renderer."
    },
    {
      "_importId": "FRONT-002",
      "cardId": "REVIEW-19",
      "title": "Error & Loading State Completeness",
      "description": "Audit all components that use Convex query hooks for missing loading and error states. Identify components that render undefined data without guards. Check offline-banner.tsx coverage.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "medium",
      "tags": ["frontend", "ux"],
      "definitionOfDone": "All Convex query consumers handle loading and error states. No unguarded undefined access.",
      "testingCriteria": "Components render gracefully with undefined/error data in Storybook or manual testing."
    },
    {
      "_importId": "DEP-001",
      "cardId": "REVIEW-20",
      "title": "Security Vulnerability Scan — npm audit & CVE cross-reference",
      "description": "Run npm audit and document all findings. Cross-reference next@16.1.6 against CVE-2025-29927 patch status. Check convex@1.31.7 and chokidar@4.0.3 for known issues. Review recently updated packages for supply chain risk.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "high",
      "tags": ["dependencies", "security"],
      "definitionOfDone": "DEP-AUDIT.md created with all vulnerabilities and remediation plan. No HIGH/CRITICAL npm audit findings left unresolved.",
      "testingCriteria": "npm audit exits with code 0 or all remaining issues are documented as accepted risks."
    },
    {
      "_importId": "DEP-002",
      "cardId": "REVIEW-21",
      "title": "Outdated Dependencies & Unnecessary Packages Audit",
      "description": "Run npm outdated. Assess upgrade paths for convex, next, react. Check if tw-animate-css is actually used. Review convex-helpers usage. Document upgrade plan with risk assessment per package.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "medium",
      "tags": ["dependencies", "maintenance"],
      "definitionOfDone": "Upgrade plan documented. Critical security updates applied. Unused packages removed.",
      "testingCriteria": "npm build succeeds after updates. All E2E tests pass."
    },
    {
      "_importId": "PERF-001",
      "cardId": "REVIEW-22",
      "title": "Server vs Client Component Audit — reduce client bundle",
      "description": "Audit 'use client' directives for unnecessary placement. Identify pages that could be static. Assess ConvexProvider client rendering impact. Check recharts and @dnd-kit lazy loading.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "low",
      "tags": ["performance", "frontend"],
      "definitionOfDone": "Client boundary is as narrow as possible. Large libraries (recharts, dnd-kit) are dynamically imported.",
      "testingCriteria": "Bundle size reduced by ≥10% vs baseline. Core Web Vitals maintained."
    },
    {
      "_importId": "PERF-002",
      "cardId": "REVIEW-23",
      "title": "Convex Query Optimization — pagination & efficient lookups",
      "description": "Add pagination to tasks.getAll() and export.getFullExport(). Replace getByCardId .collect().find() with proper indexed search. Identify queries that load unnecessary full table scans.",
      "status": "backlog",
      "assignee": "dali",
      "priority": "low",
      "tags": ["performance", "convex"],
      "definitionOfDone": "getAll() and getFullExport() support pagination. getByCardId uses search index. No unnecessary full table scans.",
      "testingCriteria": "Query times measured before and after. Improvement documented."
    }
  ]
}
